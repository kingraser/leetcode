package leetcode;

import leetcode.util.TestUtil;
import org.junit.Test;

/**
 * @author Wit
 */
public class ContinuousSubArrays {
	/*
	You are given a 0-indexed integer array nums. A subarray of nums is called continuous if:
	Let i, i + 1, ..., j be the indices in the subarray. Then, for each pair of indices i <= i1, i2 <= j, 0 <= |nums[i1] - nums[i2]| <= 2.
	Return the total number of continuous sub-arrays.
	A subarray is a contiguous non-empty sequence of elements within an array.

	Example 1:
	Input: nums = [5,4,2,4]
	Output: 8
	Explanation:
	Continuous subarray of size 1: [5], [4], [2], [4].
	Continuous subarray of size 2: [5,4], [4,2], [2,4].
	Continuous subarray of size 3: [4,2,4].
	There are no sub-arrays of size 4.
	Total continuous sub-arrays = 4 + 3 + 1 = 8.
	It can be shown that there are no more continuous sub-arrays.

	Example 2:
	Input: nums = [1,2,3]
	Output: 6
	Explanation:
	Continuous subarray of size 1: [1], [2], [3].
	Continuous subarray of size 2: [1,2], [2,3].
	Continuous subarray of size 3: [1,2,3].
	Total continuous sub-arrays = 3 + 2 + 1 = 6.

	Constraints:
	1 <= nums.length <= 10^5
	1 <= nums[i] <= 10^9
	*/
	@Test
	public void test() {
		TestUtil.testEquals(new Object[][]{
				{9L, new int[]{78, 77, 76, 75}},
				{45L, new int[]{61, 62, 61, 61, 60, 61, 61, 60, 61}},
				{9319L, new int[]{798314, 798315, 798315, 798316, 798316, 798316, 798317, 798318, 798317, 798316, 798315, 798315, 798316, 798315, 798315, 798316, 798316, 798317, 798318, 798318, 798317, 798318, 798317, 798316, 798317, 798317, 798318, 798317, 798316, 798315, 798314, 798314, 798314, 798314, 798313, 798313, 798312, 798311, 798311, 798311, 798312, 798312, 798311, 798312, 798313, 798313, 798314, 798315, 798314, 798313, 798313, 798314, 798315, 798316, 798317, 798316, 798316, 798316, 798316, 798316, 798316, 798315, 798316, 798316, 798317, 798317, 798317, 798317, 798316, 798316, 798317, 798316, 798316, 798317, 798318, 798319, 798318, 798318, 798319, 798320, 798320, 798320, 798321, 798321, 798321, 798321, 798322, 798321, 798320, 798319, 798318, 798319, 798319, 798320, 798319, 798318, 798317, 798318, 798318, 798318, 798317, 798318, 798319, 798320, 798321, 798322, 798321, 798320, 798319, 798318, 798319, 798320, 798320, 798319, 798320, 798320, 798319, 798318, 798318, 798317, 798317, 798316, 798315, 798314, 798314, 798315, 798314, 798314, 798313, 798314, 798313, 798312, 798311, 798311, 798311, 798310, 798310, 798310, 798309, 798309, 798310, 798311, 798310, 798310, 798311, 798310, 798311, 798311, 798310, 798310, 798310, 798311, 798311, 798310, 798309, 798308, 798308, 798307, 798307, 798308, 798307, 798306, 798307, 798307, 798306, 798305, 798305, 798305, 798305, 798306, 798306, 798306, 798305, 798306, 798306, 798306, 798307, 798306, 798307, 798307, 798306, 798306, 798307, 798308, 798308, 798308, 798308, 798309, 798310, 798311, 798312, 798313, 798314, 798313, 798313, 798314, 798314, 798313, 798313, 798313, 798312, 798312, 798311, 798312, 798312, 798311, 798310, 798309, 798310, 798310, 798311, 798312, 798313, 798312, 798313, 798313, 798312, 798311, 798310, 798311, 798311, 798312, 798313, 798312, 798313, 798312, 798311, 798312, 798311, 798312, 798313, 798312, 798313, 798314, 798313, 798312, 798311, 798312, 798312, 798312, 798312, 798312, 798313, 798313, 798312, 798311, 798312, 798311, 798311, 798310, 798309, 798310, 798309, 798308, 798309, 798310, 798309, 798308, 798309, 798308, 798307, 798307, 798306, 798305, 798305, 798306, 798305, 798306, 798307, 798308, 798309, 798309, 798308, 798308, 798308, 798309, 798309, 798310, 798310, 798311, 798312, 798313, 798313, 798314, 798314, 798314, 798314, 798315, 798316, 798315, 798316, 798315, 798315, 798314, 798315, 798316, 798317, 798318, 798317, 798318, 798319, 798320, 798321, 798320, 798321, 798320, 798319, 798318, 798317, 798316, 798315, 798314, 798313, 798313, 798312, 798312, 798313, 798313, 798314, 798314, 798314, 798314, 798313, 798313, 798313, 798314, 798313, 798312, 798311, 798311, 798312, 798312, 798311, 798310, 798309, 798308, 798307, 798306, 798306, 798307, 798306, 798305, 798304, 798304, 798304, 798304, 798303, 798302, 798303, 798303, 798304, 798305, 798305, 798304, 798303, 798304, 798305, 798305, 798306, 798305, 798306, 798306, 798307, 798306, 798307, 798307, 798307, 798306, 798306, 798307, 798308, 798308, 798309, 798309, 798309, 798310, 798309, 798308, 798307, 798307, 798307, 798308, 798309, 798308, 798308, 798309, 798309, 798308, 798309, 798308, 798309, 798308, 798308, 798308, 798307, 798307, 798307, 798307, 798306, 798307, 798307, 798306, 798306, 798305, 798304, 798305, 798306, 798307, 798308, 798308, 798308, 798309, 798308, 798309, 798310, 798310, 798310, 798311, 798311, 798310, 798309, 798309, 798309, 798308, 798309, 798308, 798307, 798308, 798309, 798310, 798311, 798311, 798312, 798311, 798310, 798309, 798310, 798311, 798310, 798311, 798311, 798310, 798309, 798309, 798309, 798309, 798310, 798310, 798311, 798312, 798313, 798314, 798313, 798312, 798312, 798312, 798313, 798312, 798312, 798311, 798312, 798312, 798311, 798311, 798310, 798311, 798311, 798311, 798310, 798311, 798311, 798310, 798310, 798311, 798311, 798311, 798311, 798312, 798313, 798312, 798312, 798313, 798312, 798311, 798311, 798311, 798310, 798310, 798310, 798309, 798310, 798310, 798310, 798309, 798309, 798308, 798309, 798309, 798309, 798309, 798308, 798307, 798306, 798307, 798306, 798307, 798308, 798308, 798308, 798309, 798308, 798309, 798308, 798309, 798308, 798308, 798309, 798308, 798308, 798309, 798308, 798308, 798309, 798309, 798309, 798308, 798307, 798308, 798308, 798308, 798308, 798308, 798308, 798309, 798309, 798308, 798308, 798307, 798307, 798307, 798308, 798308, 798308, 798307, 798308, 798307, 798308, 798309, 798308, 798308, 798307, 798308, 798307, 798307, 798307, 798306, 798306, 798306, 798305, 798304, 798303, 798304, 798305, 798305, 798305, 798304, 798303, 798302, 798301, 798301, 798301, 798301, 798300, 798300, 798301, 798302, 798303, 798302, 798302, 798302, 798302, 798302, 798302, 798302, 798301, 798302, 798301, 798300, 798300, 798299, 798300, 798299, 798299, 798299, 798299, 798299, 798298, 798297, 798298, 798299, 798300, 798300, 798301, 798302, 798303, 798304, 798305, 798305, 798306, 798306, 798306, 798306, 798306, 798307, 798307, 798307, 798307, 798308, 798308, 798309, 798308, 798309, 798308, 798307, 798308, 798308, 798309, 798309, 798310, 798311, 798311, 798311, 798311, 798310, 798311, 798311, 798312, 798312, 798313, 798314, 798314, 798314, 798314, 798313, 798313, 798313, 798313, 798314, 798313, 798313, 798313, 798312, 798313, 798313, 798313, 798313, 798312, 798313, 798313, 798312, 798312, 798313, 798314, 798315, 798314, 798315, 798315, 798316, 798317, 798318, 798317, 798318, 798319, 798320, 798319, 798320, 798319, 798320, 798319, 798318, 798318, 798317, 798318, 798317, 798317, 798316, 798315, 798315, 798315, 798316, 798316, 798315, 798315, 798315, 798314, 798315, 798315, 798314, 798314, 798313, 798313, 798313, 798314, 798313, 798314, 798313, 798313, 798313, 798313, 798314, 798315, 798314, 798313, 798314, 798313, 798313, 798314, 798313, 798312, 798313, 798314, 798314, 798315, 798315, 798315, 798314, 798313, 798312, 798312, 798313, 798314, 798315, 798315, 798316, 798315, 798316, 798317, 798318, 798318, 798319, 798318, 798317, 798318, 798319, 798318, 798317, 798318, 798318, 798317, 798317, 798317, 798316, 798315, 798314, 798315, 798316, 798316, 798315, 798314, 798314, 798313, 798314, 798313, 798314, 798314, 798315, 798315, 798314, 798314, 798313, 798313, 798313, 798312, 798313, 798313, 798313, 798314, 798315, 798315, 798315, 798316, 798317, 798317, 798317, 798316, 798316, 798316, 798316, 798317, 798316, 798317, 798318, 798318, 798319, 798320, 798319, 798320, 798319, 798318, 798319, 798319, 798320, 798321, 798322, 798322, 798323, 798324, 798324, 798325, 798325, 798326, 798326, 798325, 798325, 798326, 798325, 798324, 798325, 798325, 798325, 798325, 798324, 798324, 798324, 798325, 798324, 798324, 798323, 798323, 798322, 798321, 798320, 798319, 798320, 798321, 798322, 798323, 798323, 798322, 798322, 798321, 798322, 798323, 798324, 798325, 798326, 798327, 798328, 798327, 798328, 798328, 798327, 798327, 798328, 798329, 798329, 798330, 798331, 798332, 798331, 798330, 798330, 798331, 798330, 798330, 798329, 798330, 798329, 798329, 798328, 798329, 798328, 798329, 798328, 798328, 798327, 798328, 798328, 798327, 798327, 798327, 798326, 798327, 798327, 798327, 798327, 798327, 798326, 798327, 798328, 798329, 798328, 798329, 798328, 798328, 798329, 798328, 798327, 798328, 798327, 798328, 798327, 798328, 798329, 798330, 798329, 798328, 798328, 798328, 798329, 798330, 798331, 798330, 798331, 798330, 798331, 798331, 798331, 798330, 798331, 798331, 798330, 798330, 798331, 798331, 798330, 798331, 798332, 798331, 798330, 798330, 798330, 798330, 798331, 798330, 798329, 798329, 798328, 798329, 798328, 798327, 798328, 798329, 798329, 798328, 798329, 798330, 798329, 798329, 798328, 798329, 798329, 798328, 798328, 798327, 798327, 798327, 798328, 798327, 798327, 798327, 798327, 798328, 798327, 798328, 798328, 798329, 798330, 798329, 798330, 798329, 798328, 798327, 798327, 798328, 798328, 798329, 798330, 798329, 798328, 798327, 798326, 798325}},
				{28L, new int[]{42, 41, 42, 41, 41, 40, 39, 38}},
				{8L, new int[]{5, 4, 2, 4}},
				{6L, new int[]{1, 2, 3}},
		});
	}

	public long continuousSubarrays(int[] nums) {
		long result = 1;
		for (int left = 0, right = 1, min = nums[0] - 2, max = min + 4; right < nums.length; result += ++right - left)
			if (nums[right] >= min && nums[right] <= max) {
				min = Math.max(min, nums[right] - 2);
				max = Math.min(max, nums[right] + 2);
			} else {
				for (left = right - 1, max = (min = nums[right] - 2) + 4; nums[left] >= min && nums[left] <= max; left--) {
					min = Math.max(min, nums[left] - 2);
					max = Math.min(max, nums[left] + 2);
				}
				left++;
			}
		return result;
	}
}
